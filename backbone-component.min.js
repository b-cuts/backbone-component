(function(e){if(typeof define==="function"&&define.amd){define(["underscore","backbone"],e)}else{e(_,Backbone)}})(function(e,t){"use strict";var n=t.Components;var r=t.View;var i=null;var s={};var o={};var u=function(e,t){s[e]||(s[e]=t)};var a=function(e){delete s[e]};var f=function(s){var o=r.prototype;var a=null;if(e.isArray(n)){e.each(n,function(e){a||(a=e[s])})}else{a=n[s]}o["insert"+s]=function(){var n="";var r=new a;var o=(e.last(arguments)||{})["wrapper"]||{};var f="component-"+s.replace(/([A-Z])/g,"-$1").replace(/^\-+/,"").toLowerCase();var l="."+f;o["htmlId"]||(o["htmlId"]=e.uniqueId(f));o["htmlClass"]||(o["htmlClass"]="");o["htmlClass"]+=" "+f;if(r instanceof t.Component){u(l,a)}n=a.prototype.generate.apply(a.prototype,arguments);n=c({html:n,componentName:s,selector:l,wrapper:o});if(e.isFunction(i)){n=i.call(this,n)}return n};if(a.prototype instanceof t.Component){o["observe"+s]=function(e){if(e){u(e,a)}}}};var l=new MutationObserver(function(t){e.each(s,function(t,n){var r=document.querySelectorAll(n+":not(.component-active)");e.each(r,function(e){var n=new t;var r=n.cid;n.setElement(e);n.activate();o[r]=n;e.className+=" component-active";e.setAttribute("data-component-id",r)})});e.each(o,function(t){var n=t.el;if(!document.body.contains(n)){n.setAttribute("data-component-id",null);n.className=e.chain(n.className.split(/\s/)).compact().without("component-active").value().join(" ");t.deactivate();t.el=null;delete o[t.cid]}})});var c=e.template('                    <span class="<%= wrapper[ "htmlClass" ] %>"                          id="<%= wrapper[ "htmlId" ] %>">                        <%= html %>                    </span>                ');t.Helper=function(){this.cid=e.uniqueId("component-");this.initialize.apply(this,arguments)};e.extend(t.Helper.prototype,{initialize:function(){},generate:function(){return""}});t.Helper.extend=t.Model.extend;t.Component=t.Helper.extend({activate:function(){},deactivate:function(){}});e.extend(t.Component.prototype,t.Events,e.pick(t.View.prototype,"$","setElement","delegateEvents","undelegateEvents"));t.Component.VERSION="0.2.0";t.Component.initialize=function(s){var o=function(n){e.each(n,function(e,n){if(typeof e==="function"&&e.prototype instanceof t.Helper){f(n)}})};s||(s={});n=s["namespace"]||n;r=s["baseViewClass"]||r;i=s["transformHTML"]||i;if(e.isArray(n)){e.each(n,o)}else{o(n)}r.prototype.unobserve=function(e){a(e)};l.observe(document.body,{childList:true,subtree:true})}})
